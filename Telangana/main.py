import sqlite3
import matplotlib
import matplotlib.pyplot as plt
from mpl_toolkits.basemap import Basemap
from matplotlib.patches import Polygon
from matplotlib.collections import PatchCollection
import numpy as np
import requests
from difflib import SequenceMatcher
import matplotlib

parlament=False #change this to True for 2020 general mp elections


def give_party(no,par=False):
	data={82: 'Telangana Rashtra Samithi', 7: 'Telangana Rashtra Samithi', 97: 'Telangana Rashtra Samithi', 80: 'Telangana Rashtra Samithi', 59: 'Telangana Rashtra Samithi', 36: 'Telangana Rashtra Samithi', 11: 'Telangana Rashtra Samithi', 5: 'Indian National Congress', 118: 'Telugu Desam', 69: 'All India Majlis-E-Ittehadul Muslimeen', 19: 'Telangana Rashtra Samithi', 14: 'Telangana Rashtra Samithi', 3: 'Telangana Rashtra Samithi', 119: 'Indian National Congress', 94: 'Telangana Rashtra Samithi', 108: 'Indian National Congress', 8: 'Telangana Rashtra Samithi', 12: 'Telangana Rashtra Samithi', 67: 'All India Majlis-E-Ittehadul Muslimeen', 66: 'All India Majlis-E-Ittehadul Muslimeen', 2: 'Telangana Rashtra Samithi', 53: 'Telangana Rashtra Samithi', 27: 'Telangana Rashtra Samithi', 86: 'Telangana Rashtra Samithi', 76: 'Telangana Rashtra Samithi', 22: 'Telangana Rashtra Samithi', 101: 'Telangana Rashtra Samithi', 41: 'Telangana Rashtra Samithi', 79: 'Telangana Rashtra Samithi', 42: 'Telangana Rashtra Samithi', 99: 'Telangana Rashtra Samithi', 65: 'Bharatiya Janta Party', 32: 'Telangana Rashtra Samithi', 31: 'Telangana Rashtra Samithi', 89: 'Indian National Congress', 48: 'Telangana Rashtra Samithi', 75: 'Telangana Rashtra Samithi', 21: 'Telangana Rashtra Samithi', 98: 'Telangana Rashtra Samithi', 61: 'Telangana Rashtra Samithi', 13: 'Telangana Rashtra Samithi', 83: 'Telangana Rashtra Samithi', 16: 'Telangana Rashtra Samithi', 26: 'Telangana Rashtra Samithi', 64: 'All India Majlis-E-Ittehadul Muslimeen', 60: 'Telangana Rashtra Samithi', 112: 'Telangana Rashtra Samithi', 6: 'Telangana Rashtra Samithi', 90: 'Telangana Rashtra Samithi', 72: 'Telangana Rashtra Samithi', 85: 'Indian National Congress', 20: 'Telangana Rashtra Samithi', 117: 'Indian National Congress', 46: 'Telangana Rashtra Samithi', 49: 'Indian National Congress', 114: 'Indian National Congress', 102: 'Telangana Rashtra Samithi', 74: 'Telangana Rashtra Samithi', 50: 'Indian National Congress', 77: 'Telangana Rashtra Samithi', 58: 'All India Majlis-E-Ittehadul Muslimeen', 44: 'Telangana Rashtra Samithi', 30: 'Telangana Rashtra Samithi', 4: 'Telangana Rashtra Samithi', 24: 'Indian National Congress', 34: 'Telangana Rashtra Samithi', 43: 'Telangana Rashtra Samithi', 88: 'Telangana Rashtra Samithi', 10: 'Telangana Rashtra Samithi', 109: 'Indian National Congress', 93: 'Indian National Congress', 57: 'Telangana Rashtra Samithi', 87: 'Telangana Rashtra Samithi', 81: 'Telangana Rashtra Samithi', 95: 'Indian National Congress', 92: 'Telangana Rashtra Samithi', 63: 'All India Majlis-E-Ittehadul Muslimeen', 35: 'Telangana Rashtra Samithi', 73: 'Telangana Rashtra Samithi', 103: 'Telangana Rashtra Samithi', 37: 'Telangana Rashtra Samithi', 9: 'Telangana Rashtra Samithi', 18: 'Telangana Rashtra Samithi', 17: 'Telangana Rashtra Samithi', 113: 'Indian National Congress', 100: 'Telangana Rashtra Samithi', 104: 'Telangana Rashtra Samithi', 54: 'Telangana Rashtra Samithi', 40: 'Telangana Rashtra Samithi', 25: 'Telangana Rashtra Samithi', 110: 'Indian National Congress', 45: 'Telangana Rashtra Samithi', 51: 'Telangana Rashtra Samithi', 23: 'All India Forward Bloc', 62: 'Telangana Rashtra Samithi', 39: 'Indian National Congress', 116: 'Telugu Desam', 70: 'Telangana Rashtra Samithi', 71: 'Telangana Rashtra Samithi', 52: 'Telangana Rashtra Samithi', 84: 'Telangana Rashtra Samithi', 33: 'Telangana Rashtra Samithi', 29: 'Telangana Rashtra Samithi', 1: 'Telangana Rashtra Samithi', 91: 'Telangana Rashtra Samithi', 56: 'Indian National Congress', 96: 'Telangana Rashtra Samithi', 47: 'Telangana Rashtra Samithi', 28: 'Telangana Rashtra Samithi', 55: 'Telangana Rashtra Samithi', 78: 'Telangana Rashtra Samithi', 107: 'Telangana Rashtra Samithi', 106: 'Telangana Rashtra Samithi', 105: 'Telangana Rashtra Samithi', 115: 'Independent', 68: 'All India Majlis-E-Ittehadul Muslimeen', 111: 'Indian National Congress', 15: 'Indian National Congress', 38: 'Telangana Rashtra Samithi'}
	partys={'All India Forward Bloc':(1,0,0,1),'All India Majlis-E-Ittehadul Muslimeen':(0,1,0,1),'Bharatiya Janta Party':(255/255, 191/255, 0,1),'Independent':(186/255, 185/255, 182/255,1),'Indian National Congress':(0,0,1,1),'Telangana Rashtra Samithi':(1, 0, 230/255),'Telugu Desam':(1, 247/255, 0)}
	if (par):
		data={8: 'BJP', 7: 'BJP', 5: 'TRS', 1: 'TRS', 6: 'INC', 10: 'BJP', 9: 'BJP', 3: 'TRS', 4: 'TRS', 21: 'BJP', 2: 'TRS', 20: 'BJP', 11: 'BJP', 19: 'BJP', 12: 'TRS', 28: 'BJP', 24: 'INC', 23: 'INC', 18: 'BJP', 27: 'BJP', 17: 'TRS', 14: 'TRS', 25: 'TRS', 119: 'TRS', 13: 'TRS', 109: 'TRS', 29: 'TRS', 15: 'INC', 26: 'BJP', 108: 'TRS', 16: 'INC', 31: 'TRS', 35: 'TRS', 32: 'TRS', 33: 'TRS', 41: 'TRS', 104: 'TRS', 34: 'TRS', 107: 'TRS', 110: 'TRS', 103: 'TRS', 36: 'TRS', 99: 'TRS', 42: 'TRS', 98: 'TRS', 37: 'TRS', 105: 'TRS', 106: 'TRS', 102: 'TRS', 117: 'TRS', 97: 'TRS', 40: 'TRS', 100: 'TRS', 39: 'TRS', 111: 'TRS', 43: 'TRS', 55: 'INC', 45: 'TRS', 94: 'INC', 118: 'TRS', 101: 'TRS', 44: 'INC', 115: 'TRS', 53: 'INC', 52: 'TRS', 96: 'TRS', 47: 'INC', 56: 'TRS', 62: 'BJP', 70: 'BJP', 59: 'BJP', 61: 'TRS', 57: 'BJP', 51: 'TRS', 63: 'TRS', 60: 'BJP', 64: 'AIMIM', 58: 'AIMIM', 65: 'BJP', 48: 'INC', 69: 'AIMIM', 113: 'TRS', 66: 'AIMIM', 112: 'TRS', 95: 'INC', 49: 'INC', 68: 'AIMIM', 93: 'INC', 67: 'AIMIM', 54: 'INC', 50: 'TRS', 91: 'TRS', 116: 'TRS', 90: 'INC', 72: 'TRS', 84: 'TRS', 114: 'TRS', 92: 'TRS', 88: 'INC', 83: 'TRS', 75: 'TRS', 89: 'INC', 86: 'INC', 87: 'INC', 73: 'TRS', 74: 'BJP', 82: 'TRS', 81: 'TRS', 77: 'BJP', 76: 'TRS', 78: 'TRS', 85: 'TRS', 79: 'TRS', 80: 'TRS', 22: 'TRS', 30: 'BJP', 38: 'INC', 46: 'TRS', 71: 'TRS'}
		partys={'All India Forward Bloc':(1,0,0,1),'AIMIM':(0,1,0,1),'BJP':(255/255, 191/255, 0,1),'Independent':(186/255, 185/255, 182/255,1),'INC':(0,0,1,1),'TRS':(1, 0, 230/255),'Telugu Desam':(1, 247/255, 0)}
	return partys[data[no]]

fig, ax = plt.subplots()
map=Basemap(projection="mill",lat_0=0, lon_0=0,llcrnrlon=77.24, llcrnrlat=15.83, urcrnrlon=81.8, urcrnrlat=20)
map.readshapefile('../data/India_AC','ap')

disp=["ADILABAD","KARIMNAGAR","NIZAMABAD","KHAMMAM","MEDAK","WARANGAL","RANGAREDDI","HYDERABAD","NALGONDA","MAHBUBNAGAR"]
map_data={'Boath (ST)': 8, 'Adilabad': 7, 'Asifabad (ST)': 5, 'Sirpur': 1, 'Khanapur (ST)': 6, 'Mudhole': 10, 'Nirmal': 9, 'Bellampalle (SC)': 3, 'Mancherial': 4, 'Jagtial': 21, 'Chennur (SC)': 2, 'Koratla': 20, 'Armur': 11, 'Balkonda': 19, 'Bodhan': 12, 'Vemulawada': 28, 'Manthani': 24, 'Ramagundam': 23, 'Nizamabad (Rural)': 18, 'Choppadandi (SC)': 27, 'Nizamabad (Urban)': 17, 'Banswada': 14, 'Peddapalle': 25, 'Bhadrachalam (ST)': 119, 'Jukkal (SC)': 13, 'Mulug (ST)': 109, 'Sircilla': 29, 'Yellareddy': 15, 'Karimnagar': 26, 'Bhupalpalle': 108, 'Kamareddy': 16, 'Huzurabad': 31, 'Narayankhed': 35, 'Husnabad': 32, 'Siddipet': 33, 'Dubbak': 41, 'Parkal': 104, 'Medak': 34, 'Waradhanapet (SC)': 107, 'Pinapaka (ST)': 110, 'Narsampet': 103, 'Andole (SC)': 36, 'Ghanpur (Station) (SC)': 99, 'Gajwel': 42, 'Jangoan': 98, 'Narsapur': 37, 'Warangal West': 105, 'Warangal East': 106, 'Mahabubabad (ST)': 102, 'Kothagudem': 117, 'Alair': 97, 'Patancheru': 40, 'Palakurthi': 100, 'Sangareddy': 39, 'Yellandu (ST)': 111, 'Medchal': 43, 'Vicarabad (SC)': 55, 'Quthbullapur': 45, 'Bhongir': 94, 'Aswaraopeta (ST)': 118, 'Dornakal (ST)': 101, 'Malkajgiri': 44, 'Wyra (ST)': 115, 'Chevella (SC)': 53, 'Serilingampally': 52, 'Thungathurthi (SC)': 96, 'Uppal': 47, 'Tandur': 56, 'Sanathnagar': 62, 'Secunderabad': 70, 'Amberpet': 59, 'Jubilee Hills': 61, 'Musheerabad': 57, 'Rajendranagar': 51, 'Nampally': 63, 'Khairatabad': 60, 'Karwan': 64, 'Malakpet': 58, 'Goshamahal': 65, 'Ibrahimpatnam': 48, 'Bahadurpura': 69, 'Palair': 113, 'Charminar': 66, 'Khammam': 112, 'Nakrekal (SC)': 95, 'Lal Bahadur Nagar': 49, 'Yakutpura': 68, 'Munugode': 93, 'Chandrayangutta': 67, 'Pargi': 54, 'Maheswaram': 50, 'Suryapet': 91, 'Sathupalle (SC)': 116, 'Kodad': 90, 'Kodangal': 72, 'Shadnagar': 84, 'Madhira (SC)': 114, 'Nalgonda': 92, 'Miryalaguda': 88, 'Kalwakurthy': 83, 'Jadcherla': 75, 'Huzurnagar': 89, 'Devarakonda (ST)': 86, 'Nagarjuna Sagar': 87, 'Narayanpet': 73, 'Mahbubnagar': 74, 'Achampet (SC)': 82, 'Nagarkurnool': 81, 'Makthal': 77, 'Devarkadra': 76, 'Wanaparthy': 78, 'Kollapur': 85, 'Gadwal': 79, 'Alampur (SC)': 80,'Dharmapuri (SC)': 22, 'Manakondur (SC)': 30, 'Zahirabad (SC)': 38, 'Kukatpalle': 46, 'Secunderabad Cantt. (SC': 71}

for info,shape in zip(map.ap_info, map.ap):
	ax.add_collection(PatchCollection([Polygon(np.array(shape))], facecolor= (1,1,1,1), edgecolor=(1,1,1,1), linewidths=.3, zorder=2))

for info,shape in zip(map.ap_info, map.ap):
	if (info['ST_NAME']=='ANDHRA PRADESH'):
		if (info['DIST_NAME'] in disp):
			ax.add_collection(PatchCollection([Polygon(np.array(shape))], facecolor= give_party(map_data[info['AC_NAME']],parlament), edgecolor=(0,0,0,1), linewidths=.3, zorder=2))
'''
x,y=map(78.9096677,18.6634184)
plt.plot(x,y, 'ok', markersize=5)'''
plt.show()